<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DepEd Regional Profile Dashboard (Offline)</title>
    <script src="assets/tailwindcss.js"></script>
    <script src="assets/lucide.js"></script>
    <style>
        body {
            font-family: system-ui, -apple-system, sans-serif;
        }

        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .gradient-text {
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-image: linear-gradient(to right, #1e3a8a, #3b82f6);
        }

        select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
        }

        .fade-in {
            animation: fadeIn 0.4s ease-out forwards;
            opacity: 0;
            transform: translateY(10px);
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Custom scrollbar for sidebar */
        aside::-webkit-scrollbar {
            width: 4px;
        }

        aside::-webkit-scrollbar-track {
            background: transparent;
        }

        aside::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }

        aside::-webkit-scrollbar-thumb:hover {
            background: #94a3b8;
        }

        /* Modal Animation */
        .modal-enter {
            opacity: 0;
            transform: scale(0.95);
        }

        .modal-enter-active {
            opacity: 1;
            transform: scale(1);
            transition: opacity 0.3s, transform 0.3s;
        }

        .modal-exit {
            opacity: 1;
            transform: scale(1);
        }

        .modal-exit-active {
            opacity: 0;
            transform: scale(0.95);
            transition: opacity 0.2s, transform 0.2s;
        }

        /* Scrollbar for leadership list */
        .leadership-scroll::-webkit-scrollbar {
            width: 4px;
        }

        .leadership-scroll::-webkit-scrollbar-track {
            background: #f1f5f9;
        }

        .leadership-scroll::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 2px;
        }
    </style>
</head>

<body class="bg-slate-50 text-slate-800 h-screen flex overflow-hidden selection:bg-blue-100 selection:text-blue-900">

    <!-- Sidebar / Filter Panel -->
    <aside class="w-80 bg-white border-r border-slate-200 flex flex-col shadow-xl z-20 h-full">
        <div class="p-8 border-b border-slate-100">
            <div class="flex items-center gap-3 mb-1">
                <div
                    class="w-10 h-10 bg-blue-600 rounded-xl flex items-center justify-center shadow-lg shadow-blue-200">
                    <i data-lucide="map" class="text-white w-6 h-6"></i>
                </div>
                <div>
                    <h1 class="text-xl font-bold tracking-tight text-slate-900">Regional Profile</h1>
                </div>
            </div>
            <p class="text-xs text-slate-500 font-medium tracking-wide uppercase mt-2">Dashboard v1.1</p>
        </div>

        <div class="p-6 flex-1 overflow-y-auto space-y-6">
            <div class="space-y-4">
                <div class="group">
                    <label
                        class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 group-focus-within:text-blue-600 transition-colors">Region</label>
                    <div class="relative">
                        <select id="region-select"
                            class="w-full bg-slate-50 border-2 border-slate-200 text-slate-700 text-sm rounded-xl focus:ring-4 focus:ring-blue-50 focus:border-blue-500 block p-3 pr-10 transition-all outline-none font-medium">
                            <option value="">Select Region</option>
                        </select>
                    </div>
                </div>

                <div class="group">
                    <label
                        class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 group-focus-within:text-blue-600 transition-colors">Division</label>
                    <div class="relative">
                        <select id="division-select" disabled
                            class="w-full bg-slate-50 border-2 border-slate-200 text-slate-700 text-sm rounded-xl focus:ring-4 focus:ring-blue-50 focus:border-blue-500 block p-3 pr-10 transition-all outline-none font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                            <option value="">Select Division</option>
                        </select>
                    </div>
                </div>

                <div class="group">
                    <label
                        class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 group-focus-within:text-blue-600 transition-colors">Legislative
                        District</label>
                    <div class="relative">
                        <select id="district-select" disabled
                            class="w-full bg-slate-50 border-2 border-slate-200 text-slate-700 text-sm rounded-xl focus:ring-4 focus:ring-blue-50 focus:border-blue-500 block p-3 pr-10 transition-all outline-none font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                            <option value="">Select District</option>
                        </select>
                    </div>
                </div>

                <div class="group">
                    <label
                        class="block text-xs font-bold text-slate-400 uppercase tracking-wider mb-2 group-focus-within:text-blue-600 transition-colors">Municipality</label>
                    <div class="relative">
                        <select id="municipality-select" disabled
                            class="w-full bg-slate-50 border-2 border-slate-200 text-slate-700 text-sm rounded-xl focus:ring-4 focus:ring-blue-50 focus:border-blue-500 block p-3 pr-10 transition-all outline-none font-medium disabled:opacity-50 disabled:cursor-not-allowed">
                            <option value="">Select Municipality</option>
                        </select>
                    </div>
                </div>
            </div>

            <button id="reset-btn"
                class="w-full py-3 px-4 rounded-xl text-sm font-semibold text-slate-500 hover:bg-slate-50 hover:text-slate-700 border border-transparent hover:border-slate-200 transition-all flex items-center justify-center gap-2">
                <i data-lucide="rotate-ccw" class="w-4 h-4"></i> Reset Filters
            </button>
        </div>

        <div class="p-6 bg-slate-50 border-t border-slate-200">
            <div class="bg-white p-4 rounded-xl border border-slate-200 shadow-sm">
                <div class="flex items-center gap-3">
                    <span class="flex h-2 w-2 relative">
                        <span
                            class="animate-ping absolute inline-flex h-full w-full rounded-full bg-green-400 opacity-75"></span>
                        <span class="relative inline-flex rounded-full h-2 w-2 bg-green-500"></span>
                    </span>
                    <p class="text-xs font-medium text-slate-500">System Active</p>
                </div>
                <p class="text-[10px] text-slate-400 mt-1">Data updated as of Jan 2026</p>
            </div>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="flex-1 overflow-x-hidden overflow-y-auto bg-slate-50/50 relative">
        <!-- Background Decor -->
        <div class="absolute top-0 left-0 w-full h-96 bg-gradient-to-br from-blue-50 to-slate-50 -z-10"></div>
        <div class="absolute top-0 right-0 w-1/3 h-96 bg-gradient-to-bl from-blue-100/40 to-transparent blur-3xl -z-10">
        </div>

        <div class="max-w-7xl mx-auto p-4 md:p-8 lg:p-12">

            <!-- Welcome State -->
            <div id="welcome-state"
                class="flex flex-col items-center justify-center min-h-[60vh] text-center space-y-6 fade-in">
                <div
                    class="w-24 h-24 bg-white rounded-3xl shadow-xl flex items-center justify-center mb-4 ring-1 ring-slate-100">
                    <i data-lucide="bar-chart-2" class="w-12 h-12 text-blue-600"></i>
                </div>
                <div class="space-y-4 max-w-lg">
                    <h2 class="text-4xl font-bold text-slate-900 tracking-tight">Select a Location</h2>
                    <p class="text-lg text-slate-500">Use the filters on the left to drill down to a specific Region,
                        Division, District, or Municipality to view the comprehensive profile.</p>
                </div>
            </div>

            <!-- Dashboard Content -->
            <div id="dashboard-content" class="hidden space-y-8">

                <!-- Headers -->
                <div class="flex flex-col md:flex-row md:items-end justify-between gap-6 fade-in"
                    style="animation-delay: 0.1s">
                    <div>
                        <div class="flex items-center gap-2 mb-2">
                            <div id="location-badge"
                                class="px-3 py-1 rounded-full bg-blue-100/80 text-blue-700 text-xs font-bold uppercase tracking-wide backdrop-blur-sm border border-blue-200">
                                Region I
                            </div>
                        </div>
                        <h2 id="main-title" class="text-4xl font-bold text-slate-900 tracking-tight leading-tight">
                            Ilocos Region</h2>
                        <p id="sub-title" class="text-lg text-slate-500 mt-2 font-light">Regional Profile Summary</p>
                    </div>
                </div>

                <!-- SECTION 1: LEADERSHIP (Full Width) -->
                <div class="w-full fade-in" style="animation-delay: 0.15s">
                    <div
                        class="card bg-white p-6 rounded-3xl shadow-[0_2px_20px_rgb(0,0,0,0.04)] border border-slate-100 flex flex-col relative overflow-hidden">

                        <!-- Header -->
                        <div class="flex items-center gap-4 mb-6 border-b border-slate-50 pb-4">
                            <div
                                class="w-12 h-12 bg-blue-50 rounded-2xl flex items-center justify-center flex-shrink-0">
                                <i data-lucide="users" class="w-6 h-6 text-blue-600"></i>
                            </div>
                            <div>
                                <p class="text-xs font-bold text-slate-400 uppercase tracking-wider"
                                    id="leadership-title">District Representatives</p>
                                <p class="text-sm text-slate-500 font-medium tracking-tight">Political Leadership &
                                    Governance</p>
                            </div>
                        </div>

                        <!-- Content Container (Grid) -->
                        <div id="leadership-content"
                            class="w-full max-h-64 overflow-y-auto leadership-scroll grid grid-cols-1 md:grid-cols-2 gap-4 px-1">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>

                <!-- ROW 1: Schools & Enrolment -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 fade-in" style="animation-delay: 0.2s">

                    <!-- School Count -->
                    <div onclick="showBreakdown('schools')"
                        class="card bg-white p-6 rounded-3xl shadow-[0_2px_20px_rgb(0,0,0,0.04)] border border-slate-100 hover:shadow-lg hover:border-indigo-200 cursor-pointer transition-all duration-300 flex flex-col justify-between group h-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <p
                                    class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-indigo-500 transition-colors">
                                    Total Schools</p>
                                <h3 id="school-count" class="text-4xl font-bold text-slate-900 mt-2 gradient-text">0
                                </h3>
                            </div>
                            <div
                                class="p-3 bg-indigo-50 text-indigo-600 rounded-xl group-hover:bg-indigo-600 group-hover:text-white transition-all duration-300 shadow-sm group-hover:shadow-indigo-200">
                                <i data-lucide="school" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-4 flex items-center gap-1 group-hover:text-indigo-400">View
                            Breakdown <i data-lucide="chevron-right" class="w-3 h-3"></i></p>
                    </div>

                    <!-- Enrolment Stats -->
                    <div onclick="showBreakdown('enrolment')"
                        class="card bg-white p-6 rounded-3xl shadow-[0_2px_20px_rgb(0,0,0,0.04)] border border-slate-100 hover:shadow-lg hover:border-emerald-200 cursor-pointer transition-all duration-300 flex flex-col justify-between group h-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <p
                                    class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-emerald-500 transition-colors">
                                    Total Enrolment</p>
                                <h3 id="enrolment-count"
                                    class="text-4xl font-bold text-slate-900 mt-2 text-emerald-600">0</h3>
                            </div>
                            <div
                                class="p-3 bg-emerald-50 text-emerald-600 rounded-xl group-hover:bg-emerald-600 group-hover:text-white transition-all duration-300 shadow-sm group-hover:shadow-emerald-200">
                                <i data-lucide="graduation-cap" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-4 flex items-center gap-1 group-hover:text-emerald-400">View
                            Breakdown <i data-lucide="chevron-right" class="w-3 h-3"></i></p>
                    </div>
                </div>

                <!-- ROW 2: Classrooms (Total, Req & Shortage) -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 fade-in" style="animation-delay: 0.3s">

                    <!-- Total Classrooms -->
                    <div onclick="showBreakdown('totalClassrooms')"
                        class="card bg-white p-6 rounded-3xl shadow-[0_2px_20px_rgb(0,0,0,0.04)] border border-slate-100 hover:shadow-lg hover:border-violet-200 cursor-pointer transition-all duration-300 flex flex-col justify-between group h-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <p
                                    class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-violet-500 transition-colors">
                                    Total Classrooms</p>
                                <h3 id="total-classrooms"
                                    class="text-4xl font-bold text-slate-900 mt-2 text-violet-600">0</h3>
                            </div>
                            <div
                                class="p-3 bg-violet-50 text-violet-600 rounded-xl group-hover:bg-violet-600 group-hover:text-white transition-all duration-300 shadow-sm group-hover:shadow-violet-200">
                                <i data-lucide="blinds" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-4 flex items-center gap-1 group-hover:text-violet-400">View
                            Breakdown <i data-lucide="chevron-right" class="w-3 h-3"></i></p>
                    </div>

                    <!-- Classroom Requirement -->
                    <div onclick="showBreakdown('classroomReq')"
                        class="card bg-white p-6 rounded-3xl shadow-[0_2px_20px_rgb(0,0,0,0.04)] border border-slate-100 hover:shadow-lg hover:border-blue-200 cursor-pointer transition-all duration-300 flex flex-col justify-between group h-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <p
                                    class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-blue-500 transition-colors">
                                    Classroom Requirement</p>
                                <h3 id="classroom-req" class="text-4xl font-bold text-slate-900 mt-2 text-blue-600">0
                                </h3>
                            </div>
                            <div
                                class="p-3 bg-blue-50 text-blue-600 rounded-xl group-hover:bg-blue-600 group-hover:text-white transition-all duration-300 shadow-sm group-hover:shadow-blue-200">
                                <i data-lucide="layout-grid" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-4 flex items-center gap-1 group-hover:text-blue-400">View
                            Breakdown <i data-lucide="chevron-right" class="w-3 h-3"></i></p>
                    </div>

                    <!-- Classroom Shortage -->
                    <div onclick="showBreakdown('classroomShortage')"
                        class="card bg-white p-6 rounded-3xl shadow-[0_2px_20px_rgb(0,0,0,0.04)] border border-slate-100 hover:shadow-lg hover:border-red-200 cursor-pointer transition-all duration-300 flex flex-col justify-between group h-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <p
                                    class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-red-500 transition-colors">
                                    Estimated Classroom Shortage</p>
                                <h3 id="classroom-shortage" class="text-4xl font-bold text-slate-900 mt-2 text-red-600">
                                    0</h3>
                            </div>
                            <div
                                class="p-3 bg-red-50 text-red-600 rounded-xl group-hover:bg-red-600 group-hover:text-white transition-all duration-300 shadow-sm group-hover:shadow-red-200">
                                <i data-lucide="alert-triangle" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-4 flex items-center gap-1 group-hover:text-red-400">View
                            Breakdown <i data-lucide="chevron-right" class="w-3 h-3"></i></p>
                    </div>
                </div>

                <!-- ROW 3: Infrastructure (Construction & Repairs) -->
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6 fade-in" style="animation-delay: 0.4s">

                    <!-- Ongoing Construction -->
                    <div onclick="showBreakdown('construction')"
                        class="card bg-white p-6 rounded-3xl shadow-[0_2px_20px_rgb(0,0,0,0.04)] border border-slate-100 hover:shadow-lg hover:border-cyan-200 cursor-pointer transition-all duration-300 flex flex-col justify-between group h-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <p
                                    class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-cyan-500 transition-colors">
                                    Ongoing Projects</p>
                                <h3 id="ongoing-construction"
                                    class="text-4xl font-bold text-slate-900 mt-2 text-cyan-600">0</h3>
                            </div>
                            <div
                                class="p-3 bg-cyan-50 text-cyan-600 rounded-xl group-hover:bg-cyan-600 group-hover:text-white transition-all duration-300 shadow-sm group-hover:shadow-cyan-200">
                                <i data-lucide="hammer" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-4 flex items-center gap-1 group-hover:text-cyan-400">View
                            Breakdown <i data-lucide="chevron-right" class="w-3 h-3"></i></p>
                    </div>

                    <!-- Major Repairs -->
                    <div onclick="showBreakdown('majorRepairs')"
                        class="card bg-white p-6 rounded-3xl shadow-[0_2px_20px_rgb(0,0,0,0.04)] border border-slate-100 hover:shadow-lg hover:border-rose-200 cursor-pointer transition-all duration-300 flex flex-col justify-between group h-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <p
                                    class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-rose-500 transition-colors">
                                    Major Repairs</p>
                                <h3 id="major-repairs" class="text-4xl font-bold text-slate-900 mt-2 text-rose-600">0
                                </h3>
                            </div>
                            <div
                                class="p-3 bg-rose-50 text-rose-600 rounded-xl group-hover:bg-rose-600 group-hover:text-white transition-all duration-300 shadow-sm group-hover:shadow-rose-200">
                                <i data-lucide="wrench" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-4 flex items-center gap-1 group-hover:text-rose-400">View
                            Breakdown <i data-lucide="chevron-right" class="w-3 h-3"></i></p>
                    </div>

                    <!-- Minor Repairs -->
                    <div onclick="showBreakdown('minorRepairs')"
                        class="card bg-white p-6 rounded-3xl shadow-[0_2px_20px_rgb(0,0,0,0.04)] border border-slate-100 hover:shadow-lg hover:border-amber-200 cursor-pointer transition-all duration-300 flex flex-col justify-between group h-full">
                        <div class="flex justify-between items-start">
                            <div>
                                <p
                                    class="text-xs font-bold text-slate-400 uppercase tracking-wider group-hover:text-amber-500 transition-colors">
                                    Minor Repairs</p>
                                <h3 id="minor-repairs" class="text-4xl font-bold text-slate-900 mt-2 text-amber-500">0
                                </h3>
                            </div>
                            <div
                                class="p-3 bg-amber-50 text-amber-600 rounded-xl group-hover:bg-amber-600 group-hover:text-white transition-all duration-300 shadow-sm group-hover:shadow-amber-200">
                                <i data-lucide="hammer" class="w-6 h-6"></i>
                            </div>
                        </div>
                        <p class="text-xs text-slate-400 mt-4 flex items-center gap-1 group-hover:text-amber-400">View
                            Breakdown <i data-lucide="chevron-right" class="w-3 h-3"></i></p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Detailed Modal (Same as before) -->
    <div id="breakdown-modal" class="fixed inset-0 z-50 hidden" aria-labelledby="modal-title" role="dialog"
        aria-modal="true">
        <!-- Background backdrop -->
        <div class="fixed inset-0 bg-slate-900/40 backdrop-blur-sm transition-opacity opacity-0" id="modal-backdrop">
        </div>

        <div class="fixed inset-0 z-10 overflow-y-auto">
            <div class="flex min-h-full items-center justify-center p-4 text-center sm:p-0">
                <div class="relative transform overflow-hidden rounded-3xl bg-white text-left shadow-2xl transition-all sm:my-8 sm:w-full sm:max-w-7xl opacity-0 scale-95"
                    id="modal-panel">
                    <div class="bg-slate-50 px-8 py-6 border-b border-slate-100 flex justify-between items-center">
                        <div>
                            <h3 class="text-xl font-bold text-slate-900 leading-6" id="modal-title">Metric Breakdown
                            </h3>
                            <p class="text-sm text-slate-500 mt-1" id="modal-subtitle">Loading details...</p>
                        </div>
                        <button type="button" onclick="closeModal()"
                            class="rounded-full p-2 bg-white text-slate-400 hover:text-slate-500 hover:bg-slate-100 transition-colors focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                            <i data-lucide="x" class="w-5 h-5"></i>
                        </button>
                    </div>
                    <div class="px-8 py-6 max-h-[60vh] overflow-y-auto bg-white">
                        <div class="overflow-hidden rounded-xl border border-slate-200">
                            <table class="min-w-full divide-y divide-slate-200">
                                <thead class="bg-slate-50">
                                    <tr>
                                        <th scope="col"
                                            class="px-6 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-wider">
                                            School ID</th>
                                        <th scope="col"
                                            class="px-6 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-wider">
                                            School Name</th>
                                        <th scope="col"
                                            class="px-6 py-4 text-left text-xs font-bold text-slate-400 uppercase tracking-wider">
                                            Municipality</th>
                                        <th scope="col"
                                            class="px-6 py-4 text-right text-xs font-bold text-slate-400 uppercase tracking-wider"
                                            id="modal-metric-header">Count</th>
                                    </tr>
                                </thead>
                                <tbody class="bg-white divide-y divide-slate-100" id="modal-table-body">
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="bg-slate-50 px-8 py-4 flex justify-between items-center border-t border-slate-100">
                        <p class="text-xs text-slate-400 italic">* Simulated data for demonstration</p>
                        <button type="button" onclick="closeModal()"
                            class="inline-flex w-full justify-center rounded-xl bg-white px-4 py-2.5 text-sm font-semibold text-slate-900 shadow-sm ring-1 ring-inset ring-slate-300 hover:bg-slate-50 sm:ml-3 sm:w-auto transition-colors">Close</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Script same as before -->
    <!-- Script -->
    <script src="dashboard_data.js"></script>
    <script>
        // Use external data if available, otherwise fallback to empty or mock
        let database = [];
        if (typeof parsedDatabase !== 'undefined') {
            database = parsedDatabase; // parsedDatabase is now the full array
        } else {
            console.warn("External dashboard_data.js not loaded. Dashboard will be empty.");
        }
        // Mock data block removed.


        // DOM Elements and Init Logic remain same...
        const regionSelect = document.getElementById('region-select');
        const divisionSelect = document.getElementById('division-select');
        const districtSelect = document.getElementById('district-select');
        const municipalitySelect = document.getElementById('municipality-select');
        const resetBtn = document.getElementById('reset-btn');

        const welcomeState = document.getElementById('welcome-state');
        const dashboardContent = document.getElementById('dashboard-content');

        const mainTitle = document.getElementById('main-title');
        const subTitle = document.getElementById('sub-title');
        const locationBadge = document.getElementById('location-badge');

        const leadershipTitle = document.getElementById('leadership-title');
        const leadershipContent = document.getElementById('leadership-content');

        const schoolCount = document.getElementById('school-count');
        const enrolmentCount = document.getElementById('enrolment-count');
        const classroomReq = document.getElementById('classroom-req');
        const totalClassrooms = document.getElementById('total-classrooms');
        const classroomShortage = document.getElementById('classroom-shortage');
        const ongoingConstruction = document.getElementById('ongoing-construction');
        const majorRepairs = document.getElementById('major-repairs');
        const minorRepairs = document.getElementById('minor-repairs');

        const modal = document.getElementById('breakdown-modal');
        const modalBackdrop = document.getElementById('modal-backdrop');
        const modalPanel = document.getElementById('modal-panel');
        const modalTitle = document.getElementById('modal-title');
        const modalSubtitle = document.getElementById('modal-subtitle');
        const modalMetricHeader = document.getElementById('modal-metric-header');
        const modalTableBody = document.getElementById('modal-table-body');

        let currentLevel = null;
        let currentData = null;
        let currentLocationName = "";

        try {
            lucide.createIcons();
        } catch (e) {
            console.error("Error creating Lucide icons:", e);
        }

        function populateDropdown(selectElement, items, defaultText = "Select Option") {
            console.log(`Populating ${selectElement.id} with ${items.length} items.`);
            selectElement.innerHTML = `<option value="">${defaultText}</option>`;
            items.forEach(item => {
                const option = document.createElement('option');
                option.value = item;
                option.textContent = item;
                selectElement.appendChild(option);
            });
            selectElement.disabled = items.length === 0;
            if (items.length === 0) console.warn(`${selectElement.id} is disabled because items list is empty.`);
        }

        console.log("Database entries:", database.length);
        const regions = database.map(d => d.region);
        console.log("Regions found:", regions);
        populateDropdown(regionSelect, regions, "Select Region");

        regionSelect.addEventListener('change', (e) => {
            const regionName = e.target.value;
            const region = database.find(d => d.region === regionName);

            divisionSelect.innerHTML = '<option value="">Select Division</option>'; divisionSelect.disabled = true;
            districtSelect.innerHTML = '<option value="">Select District</option>'; districtSelect.disabled = true;
            municipalitySelect.innerHTML = '<option value="">Select Municipality</option>'; municipalitySelect.disabled = true;

            if (region) {
                const divisions = region.divisions.map(d => d.name);
                populateDropdown(divisionSelect, divisions, "Select Division");
                updateDashboard("region", region);
            } else {
                showWelcome();
                currentData = null;
            }
        });

        divisionSelect.addEventListener('change', (e) => {
            const divName = e.target.value;
            const region = database.find(d => d.region === regionSelect.value);
            const division = region.divisions.find(d => d.name === divName);

            districtSelect.innerHTML = '<option value="">Select District</option>'; districtSelect.disabled = true;
            municipalitySelect.innerHTML = '<option value="">Select Municipality</option>'; municipalitySelect.disabled = true;

            if (division) {
                const districts = division.districts.map(d => d.name);
                populateDropdown(districtSelect, districts, "Select District");
                updateDashboard("division", division);
            }
        });

        districtSelect.addEventListener('change', (e) => {
            const distName = e.target.value;
            const region = database.find(d => d.region === regionSelect.value);
            const division = region.divisions.find(d => d.name === divisionSelect.value);
            const district = division.districts.find(d => d.name === distName);

            municipalitySelect.innerHTML = '<option value="">Select Municipality</option>'; municipalitySelect.disabled = true;

            if (district) {
                const municipalities = district.municipalities.map(d => d.name);
                populateDropdown(municipalitySelect, municipalities, "Select Municipality");
                updateDashboard("district", district);
            }
        });

        municipalitySelect.addEventListener('change', (e) => {
            const muniName = e.target.value;
            if (muniName) {
                const region = database.find(d => d.region === regionSelect.value);
                const division = region.divisions.find(d => d.name === divisionSelect.value);
                const district = division.districts.find(d => d.name === districtSelect.value);
                const muni = district.municipalities.find(d => d.name === muniName);

                updateDashboard("municipality", muni);
            }
        });

        resetBtn.addEventListener('click', () => {
            regionSelect.value = "";
            regionSelect.dispatchEvent(new Event('change'));
        });

        function showWelcome() {
            welcomeState.classList.remove('hidden');
            dashboardContent.classList.add('hidden');
        }

        function selectDistrict(divName, distName) {
            if (divisionSelect.value !== divName) {
                divisionSelect.value = divName;
                divisionSelect.dispatchEvent(new Event('change'));
            }
            setTimeout(() => {
                districtSelect.value = distName;
                districtSelect.dispatchEvent(new Event('change'));
            }, 50);
        }

        function updateDashboard(level, data) {
            welcomeState.classList.add('hidden');
            dashboardContent.classList.remove('hidden');

            dashboardContent.classList.remove('fade-in');
            void dashboardContent.offsetWidth;
            dashboardContent.classList.add('fade-in');

            currentLevel = level;
            currentData = data;

            let stats = { schools: 0, enrolment: 0, totalClassrooms: 0, classroomReq: 0, classroomShortage: 0, construction: 0, minorRepairs: 0, majorRepairs: 0 };
            let displayTitle = "";
            let displaySub = "";
            let badgeText = "";

            let congressmen = [];
            let seenCong = new Set();
            let mayor = null;
            let leaderLabel = "";

            function addCong(name, location, divName, distName) {
                const key = `${name}-${location}`;
                if (name && !seenCong.has(key)) {
                    seenCong.add(key);
                    congressmen.push({ name: name, location: location, divName: divName, distName: distName });
                }
            }

            if (level === "region") {
                displayTitle = data.region;
                displaySub = "Regional Overview";
                badgeText = "REGION";
                leaderLabel = "District Representatives";
                currentLocationName = data.region;

                data.divisions.forEach(div => {
                    div.districts.forEach(dist => {
                        if (dist.municipalities.length > 0) {
                            addCong(dist.municipalities[0].congressman, `${div.name}, ${dist.name}`, div.name, dist.name);
                        }
                        dist.municipalities.forEach(m => accumulateStats(stats, m));
                    });
                });

            } else if (level === "division") {
                displayTitle = data.name + " Division";
                displaySub = "Division Overview";
                badgeText = "DIVISION";
                leaderLabel = "District Representatives";
                currentLocationName = data.name;

                data.districts.forEach(dist => {
                    if (dist.municipalities.length > 0) {
                        addCong(dist.municipalities[0].congressman, dist.name, data.name, dist.name);
                    }
                    dist.municipalities.forEach(m => accumulateStats(stats, m));
                });

            } else if (level === "district") {
                const divName = divisionSelect.value;
                displayTitle = `${data.name}, ${divName}`;
                displaySub = "Legislative District Profile";
                badgeText = "DISTRICT";
                leaderLabel = "District Representative";
                currentLocationName = `${data.name}, ${divName}`;

                if (data.municipalities.length > 0) {
                    addCong(data.municipalities[0].congressman, data.name, divName, data.name);
                }

                data.municipalities.forEach(m => accumulateStats(stats, m));

            } else if (level === "municipality") {
                const divName = divisionSelect.value;
                const distName = districtSelect.value;
                displayTitle = data.name;
                displaySub = `${distName}, ${divName}`;
                badgeText = "MUNICIPALITY";
                leaderLabel = "Local Leadership";
                currentLocationName = data.name;

                addCong(data.congressman, distName, divName, distName);
                mayor = data.mayor;

                stats = {
                    schools: data.schools,
                    enrolment: data.enrolment,
                    totalClassrooms: data.totalClassrooms,
                    classroomReq: data.classroomReq,
                    classroomShortage: data.classroomShortage,
                    construction: data.construction,
                    minorRepairs: data.minorRepairs,
                    majorRepairs: data.majorRepairs
                };
            }

            mainTitle.textContent = displayTitle;
            subTitle.textContent = displaySub;
            locationBadge.textContent = badgeText;
            schoolCount.textContent = stats.schools.toLocaleString();
            enrolmentCount.textContent = stats.enrolment.toLocaleString();
            totalClassrooms.textContent = stats.totalClassrooms.toLocaleString();
            classroomReq.textContent = stats.classroomReq.toLocaleString();
            classroomShortage.textContent = stats.classroomShortage.toLocaleString();
            ongoingConstruction.textContent = stats.construction.toLocaleString();
            majorRepairs.textContent = stats.majorRepairs.toLocaleString();
            minorRepairs.textContent = stats.minorRepairs.toLocaleString();

            leadershipTitle.textContent = leaderLabel;
            leadershipContent.innerHTML = "";

            if (mayor) {
                // Update Layout for Municipality (Two side-by-side cards)
                const cong = congressmen[0] ? congressmen[0].name : "N/A";
                leadershipContent.innerHTML = `
        <div class="col-span-1 md:col-span-1 text-center bg-slate-50 p-6 rounded-2xl border border-slate-100 flex flex-col items-center justify-center gap-2">
            <p class="text-[10px] font-bold text-slate-400 uppercase tracking-wide">Municipal Mayor</p>
            <p class="font-bold text-slate-800 text-xl leading-tight">${mayor}</p>
        </div>
        <div class="col-span-1 md:col-span-1 text-center bg-blue-50/50 p-6 rounded-2xl border border-blue-100 flex flex-col items-center justify-center gap-2">
            <p class="text-[10px] font-bold text-blue-400 uppercase tracking-wide">Representative</p>
            <p class="font-bold text-blue-900 text-lg leading-tight">${cong}</p>
        </div>
        `;
            } else {
                if (congressmen.length > 0) {
                    congressmen.forEach(cong => {
                        const item = document.createElement('div');

                        let hoverClass = "";
                        let iconColor = "bg-blue-400";

                        if (level === 'region' || level === 'division') {
                            hoverClass = "cursor-pointer hover:bg-blue-50 hover:shadow-sm";
                            iconColor = "bg-blue-500 group-hover:scale-110 transition-transform";
                            item.onclick = function () { selectDistrict(cong.divName, cong.distName); };
                        } else {
                            hoverClass = "cursor-default";
                        }

                        item.className = `p-4 rounded-2xl border border-slate-100 hover:border-blue-100 flex items-center gap-4 group transition-all bg-white ${hoverClass}`;

                        item.innerHTML = `
                            <div class="w-2 h-2 rounded-full ${iconColor} flex-shrink-0"></div>
                            <div class="flex-1 min-w-0">
                                <span class="block text-[10px] font-bold text-slate-400 uppercase tracking-wider mb-0.5 group-hover:text-blue-500 transition-colors truncate">${cong.location}</span>
                                <span class="block text-slate-700 font-bold text-base leading-tight group-hover:text-blue-700 transition-colors truncate">${cong.name}</span>
                            </div>
                            ${(level === 'region' || level === 'division') ? '<div class="opacity-0 group-hover:opacity-100 transition-opacity"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="text-blue-400"><path d="m9 18 6-6-6-6"/></svg></div>' : ''}
                         `;
                        leadershipContent.appendChild(item);
                    });
                } else {
                    leadershipContent.innerHTML = `<p class="text-sm text-slate-400 italic col-span-full text-center py-4">No representatives found.</p>`;
                }
            }
        }

        function accumulateStats(stats, muni) {
            stats.schools += muni.schools;
            stats.enrolment += (muni.enrolment || 0);
            stats.totalClassrooms += (muni.totalClassrooms || 0);
            stats.classroomReq += muni.classroomReq;
            stats.classroomShortage += (muni.classroomShortage || 0);
            stats.construction += muni.construction;
            stats.minorRepairs += (muni.minorRepairs || 0);
            stats.majorRepairs += (muni.majorRepairs || 0);
        }

        function showBreakdown(metric) {
            if (!currentData || !currentLevel) return;

            const metricTitles = {
                'schools': 'Total Schools Breakdown',
                'enrolment': 'Enrolment Breakdown',
                'totalClassrooms': 'Total Instructional Rooms Breakdown',
                'classroomReq': 'Classroom Requirement Breakdown',
                'classroomShortage': 'Classroom Shortage Breakdown',
                'construction': 'Ongoing Construction Projects',
                'majorRepairs': 'Major Repairs Breakdown',
                'minorRepairs': 'Minor Repairs Breakdown'
            };

            modalTitle.textContent = metricTitles[metric] || 'Details';
            modalSubtitle.textContent = `Showing details for ${currentLocationName}`;

            const tableRows = generateBreakdownData(metric);
            modalTableBody.innerHTML = tableRows;

            modal.classList.remove('hidden');
            setTimeout(() => {
                modalBackdrop.classList.remove('opacity-0');
                modalPanel.classList.remove('opacity-0', 'scale-95');
                modalPanel.classList.add('opacity-100', 'scale-100');
            }, 10);
        }

        function closeModal() {
            modalBackdrop.classList.add('opacity-0');
            modalPanel.classList.remove('opacity-100', 'scale-100');
            modalPanel.classList.add('opacity-0', 'scale-95');
            setTimeout(() => {
                modal.classList.add('hidden');
            }, 300);
        }

        modalBackdrop.addEventListener('click', closeModal);

        function generateBreakdownData(metric) {
            let munis = [];

            if (currentLevel === 'region') {
                currentData.divisions.forEach(d => d.districts.forEach(dist => munis.push(...dist.municipalities)));
            } else if (currentLevel === 'division') {
                currentData.districts.forEach(dist => munis.push(...dist.municipalities));
            } else if (currentLevel === 'district') {
                munis.push(...currentData.municipalities);
            } else if (currentLevel === 'municipality') {
                munis.push(currentData);
            }

            let html = '';

            let allSchools = [];
            munis.forEach(muni => {
                const schoolList = muni.schoolList || [];
                schoolList.forEach(school => {
                    let val = 0;
                    if (metric === 'schools') val = 1;
                    else val = school[metric] || 0;

                    if (val > 0) {
                        allSchools.push({
                            ...school,
                            muniName: muni.name,
                            displayVal: val
                        });
                    }
                });
            });

            // Sort descending by value
            allSchools.sort((a, b) => b.displayVal - a.displayVal);

            // Optional: limit to top 1000 to prevent browser lag if list is huge
            const limit = 1000;
            const displaySchools = allSchools.slice(0, limit);

            displaySchools.forEach(school => {
                html += `
                <tr class="hover:bg-slate-50 transition-colors">
                    <td class="px-6 py-4 whitespace-nowrap text-xs font-mono text-slate-500">${school.id || 'N/A'}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-slate-800">${school.name}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">${school.muniName}</td>
                    <td class="px-6 py-4 whitespace-nowrap text-sm text-right font-bold text-blue-600">${school.displayVal.toLocaleString()}</td>
                </tr>
            `;
            });

            if (allSchools.length > limit) {
                html += `
                <tr class="bg-slate-50/50">
                    <td class="px-6 py-2"></td>
                    <td class="px-6 py-2 text-xs text-slate-500 italic" colspan="2">+ ${allSchools.length - limit} more schools...</td>
                    <td class="px-6 py-2 text-right text-xs font-bold text-slate-400">...</td>
                </tr>
            `;
            }

            if (html === '') {
                html = '<tr><td colspan="4" class="px-6 py-8 text-center text-slate-400">No records found for this category.</td></tr>';
            }

            return html;
        }

        // Close modal on Escape key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && !modal.classList.contains('hidden')) {
                closeModal();
            }
        });

        // Close modal on click outside (backdrop)
        modal.addEventListener('click', (e) => {
            // Close if the click is outside the modal panel property
            if (!modal.classList.contains('hidden') && !modalPanel.contains(e.target)) {
                closeModal();
            }
        });
    </script>
</body>

</html>